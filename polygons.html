<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>The Area of Intersecting Polygons</title>

    <link rel="stylesheet" href="polygons.css">
    <link rel="stylesheet" href="libs/sweet-alert/sweetalert.css">
    <script>
        delete window.require;
        delete window.exports;
        delete window.module;
    </script>
</head>
<body>
    <div id="polygonDataId" class="polygonDataClass">
        <h2><b>Введите количество вершин<br>для многоугольников в пластинах</b></h2>
        <p>Многоугольник <b>верхней</b> пластины = <input id="subjectPolygonVertexCountId" type="text" name="subjectPolygonVertexCount">
            <br>Радиус <b>верхней</b> пластины = <input id="upperCircleRadiusId" type="text" name="upperCircleRadius">
        </p>
        <p>Многоугольник <b>нижней</b> пластины = <input id="clipPolygonVertexCountId" type="text" name="clipPolygonVertexCount">
            <br>Радиус <b>нижней</b> пластины = <input id="lowerCircleRadiusId" type="text" name="lowerCircleRadius">
        </p>
        <p><button id="runScriptId">Get Input</button></p>

        <br>
        <div id="subjectPolygonInputDataId" class="subjectPolygonInputDataClass"></div>
        <div id="clipPolygonInputDataId" class="clipPolygonInputDataClass"></div>
        <br><button id='readInputId' class="readInputClass">Run</button>
    </div>
    <canvas id="coordinateSystemId" class="coordinateSystemClass" width="500" height="500"></canvas>
    <div id="coordinatesOutputsId"></div>

    <script src="libs/jquery-3.1.1.min.js"></script>
    <script src="libs/sweet-alert/sweetalert.min.js"></script>

    <script src="polygons-Sutherland-Hodgeman.js"></script>
    <script src="polygonsDrawer.js"></script>

    <script>
        /////////////////////////////////////////////////////////////
        $("#runScriptId").click(function () {
            $("#subjectPolygonInputDataId").empty();
            $("#clipPolygonInputDataId").empty();

            window.subjectPolygonVertexCount = $("input[name='subjectPolygonVertexCount']").val();
            window.clipPolygonVertexCount = $("input[name='clipPolygonVertexCount']").val();

            $("#subjectPolygonInputDataId").append("<b>Координаты<br>многоугольника на<br>нижней пластине<br>(неподвижной)</b>");
            for (var i = 0; i < subjectPolygonVertexCount; i++) {
                $("#subjectPolygonInputDataId").append("<br>x" + "<sub>" + (i + 1) + "</sub>" +" = <input type='text' name='x'> " +
                                                          "y" + "<sub>" + (i + 1) + "</sub>" +" = <input type='text' name='y'>");
            }

            $("#clipPolygonInputDataId").append("<b>Координаты<br>многоугольника на<br>верхней пластине<br>(подвижной)</b>");
            for (i = 0; i < clipPolygonVertexCount; i++) {
                $("#clipPolygonInputDataId").append("<br>x" + "<sub>" + (i + 1) + "</sub>" +" = <input type='text' name='x'> " +
                                                       "y" + "<sub>" + (i + 1) + "</sub>" +" = <input type='text' name='y'>");
            }
            $("#readInputId").show();
        })
        $("#readInputId").click(function () {
            $("#coordinatesOutputsId").empty();
            //clear canvas
            myGraph.clearCanvas();

            /////////////////////////////////////////////////////////////

            var subjectPolygon = [];
            var clipPolygon = [];
            var crutchX = [];
            var crutchY = [];

            $("#subjectPolygonInputDataId input[name$='x']").each(function (index) {
                crutchX[index] = parseInt($(this).val());
            });
            $("#subjectPolygonInputDataId input[name^='y']").each(function (index) {
                crutchY[index] = parseInt($(this).val());
            });
            for(var rows = 0; rows < crutchX.length; rows++) {
                subjectPolygon.push([crutchX[rows], crutchY[rows]]);
            }

            crutchX = [];
            crutchY = [];

            $("div#clipPolygonInputDataId input[name^='x']").each(function (index) {
                crutchX[index] = parseInt($(this).val());
            });
            $("div#clipPolygonInputDataId input[name^='y']").each(function (index) {
                crutchY[index] = parseInt($(this).val());
            });
            for(rows = 0; rows < crutchX.length; rows++) {
                clipPolygon.push([crutchX[rows], crutchY[rows]]);
            }

            /////////////////////////////////////////////////////////////
//           var subjectPolygon = [[10, 10], [70, 30], [50, 50]],
//               clipPolygon = [[20, 20], [77, 0], [0, 90]];
            var clippedPolygon = clip(subjectPolygon, clipPolygon);

            alert("subjectPolygon = " + subjectPolygon + " clipPolygon = " + clipPolygon);

            myGraph.drawPolygons(function () {}, subjectPolygon, '#363636', '#6599FF', 1);
            myGraph.drawPolygons(function () {}, clipPolygon, '#363636', '#097054', 1);
            myGraph.drawPolygons(function () {}, clippedPolygon, '#FFDE00', '#FF9900', 2);

            // reDraw coordinate system in max lvl
            myGraph.drawXAxis();
            myGraph.drawYAxis();

            $("#coordinatesOutputsId").append("Intersecting coordinates count is " + clippedPolygon.length);

            for (var i = 0; i < clippedPolygon.length; i++) {
                $("#coordinatesOutputsId").append("<br>(X" + "<sub>" + (i + 1) + "</sub>" + "; Y" + "<sub>" + (i + 1) + "</sub>" + ") = (" + clippedPolygon[i] + ")");
            }

            // polygon area calculation
            // http://www.mathwords.com/a/area_convex_polygon.htm
            var areaCoordinatesClippedPolygon = clip(subjectPolygon, clipPolygon);
            var XnYn_plus_1 = 0, YnXn_plus_1 = 0;

            areaCoordinatesClippedPolygon.push(areaCoordinatesClippedPolygon[0]);
            for (var j = 0; j < areaCoordinatesClippedPolygon.length; j++) {
                if ((j + 1) < areaCoordinatesClippedPolygon.length) {
                    XnYn_plus_1 = XnYn_plus_1 + (areaCoordinatesClippedPolygon[j][0] * areaCoordinatesClippedPolygon[j + 1][1]);
                    YnXn_plus_1 = YnXn_plus_1 + (areaCoordinatesClippedPolygon[j][1] * areaCoordinatesClippedPolygon[j + 1][0]);
                }
            }
            var areaClippedPolygon = 1 / 2 * Math.abs((XnYn_plus_1) - (YnXn_plus_1));
            $("#coordinatesOutputsId").append("<br> Area of clipped polygon = " + areaClippedPolygon + " см<sup>2</sup>");

            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            var centroidAxis = centroid(clippedPolygon);
            $("#coordinatesOutputsId").append("<br> Centroid = (" + centroidAxis[0] + "; " + centroidAxis[1] + ")");
            myGraph.drawCoordinate(function () {}, centroidAxis[0], centroidAxis[1], 1, 1);

        })
    </script>

</body>
</html>